// Prisma schema for TC Warranty Form

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Submission {
  id                  String    @id @default(uuid())
  timestamp           DateTime  @default(now())
  vorname             String
  nachname            String
  strasseHausnummer   String
  plz                 String
  ort                 String
  tcNummer            String
  email               String
  telefon             String
  beschreibung        String    @db.Text
  dsgvoAccepted       Boolean   @default(true)
  status              Status    @default(OFFEN)
  ersteFrist          DateTime?
  zweiteFrist         DateTime?
  erledigtAm          DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  files               File[]

  @@index([tcNummer])
  @@index([status])
  @@index([timestamp(sort: Desc)])
}

model File {
  id            String     @id @default(uuid())
  submissionId  String
  name          String
  type          String
  size          Int
  url           String
  uploadedAt    DateTime   @default(now())

  submission    Submission @relation(fields: [submissionId], references: [id], onDelete: Cascade)

  @@index([submissionId])
}

enum Status {
  OFFEN
  IN_BEARBEITUNG
  ERLEDIGT
}
